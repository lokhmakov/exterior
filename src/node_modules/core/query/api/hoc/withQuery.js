import React, { Component } from 'react'
import { connect }          from 'react-redux'


import queryTypes           from 'core/query/api/types'


export default ({
  name,
  query,

  mapProps,
}) => (WrappedComponent) => {
  @connect((state, ownProps) => {
    return {
      [name]: state.query[name],
    }
  })

  class Query extends Component {
    query = async () => {
      this.props.dispatch({
        type: queryTypes.START,
        payload: mapProps(this.props),
      })
    }

    render() {
      return (
        <WrappedComponent
          {...this.props}
        />
      )
    }
  }

  return Query
}