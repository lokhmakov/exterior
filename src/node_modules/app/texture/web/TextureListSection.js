import React, { Component } from 'react'


import modeMap              from 'app/project/api/modeMap'
import textureQuery         from 'app/group/api/local/query'
import projectUpdate        from 'app/project/api/local/update'
import projectQuery         from 'app/project/api/local/query'
import GroupList            from 'app/group/web/GroupList'

import createDebugger       from 'core/debug/api/create'
import Mutation             from 'core/mutation/web/Mutation'
import Query                from 'core/query/web/Query'


import Block                from 'layout/web/Block'


const debug = createDebugger(`app:texture:web:TextureListSection`)

class TextureListSection extends Component {
  renderGroupQuery = (doc) => ({ data, order }) => {
    debug(`renderGroupQuery()`, data, order)

    return (
      <Mutation
        name='projectUpdate'
        entity='project'

        mutation={ projectUpdate }
      >
        {({ mutate }) => (
          <GroupList
            data={ data }
            order={ order }

            onClick={({ id: groupId, }) => mutate({
              ...doc,

              mode: doc.mode === modeMap.DEFAULT
                || doc.mode === modeMap.GROUP_MANAGE
                ? modeMap.GROUP_PERSPECTIVE
                : modeMap.GROUP_MANAGE,
              groupId,
            })}

            onFinish={() => mutate({
              ...doc,

              mode: modeMap.DEFAULT,
            })}
          />
        )}
      </Mutation>
    )
  }

  renderProjectQuery = ({ data, order }) => {
    const { id } = this.props
    const doc = data[id]

    return (
      <Query
        name='groupQuery'
        entity='group'

        query={ groupQuery }
      >
        { this.renderGroupQuery(doc) }
      </Query>
    )
  }

  render() {
    return (
      <Block style={{ height: 60 }} center middle>
        <Query
          name='projectQuery'
          entity='project'

          query={ projectQuery }
        >
          { this.renderProjectQuery }
        </Query>      
      </Block>
    )
  }
}

export default TextureListSection